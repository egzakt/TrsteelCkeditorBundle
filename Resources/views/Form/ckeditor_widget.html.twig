{% block ckeditor_widget %}
{% spaceless %}
    <textarea {{ block('widget_attributes') }}>{{ value }}</textarea>

    <script type="text/javascript">
    {% autoescape true js %}
        var CKEDITOR_BASEPATH = '{{ app.request.basePath ~ '/' ~ base_path }}';
    {% endautoescape %}
    </script>

    <script type="text/javascript" src="{{ asset(base_path ~ 'ckeditor.js') }}"></script>
    <script type="text/javascript">
    {% autoescape false %}
        {% for name, definition_set in templates_definition_sets %}
            {% if definition_set.templates is defined and definition_set.templates|length > 0 %}
                CKEDITOR.addTemplates( '{{ name }}' , {
                    {% if definition_set.imagesPath is not null %}
                    imagesPath: '{{ definition_set.imagesPath }}',
                    {% endif %}
                    templates: [
                        {% for template in definition_set.templates %}
                        {
                            {% if template.image is not null %}
                            image: '{{ template.image }}',
                            {% endif %}
                            {% if template.description is not null %}
                            description: '{{ template.description }}',
                            {% endif %}
                            {% if template.html is not null %}
                            html: '{{ template.html }}',
                            {% elseif template.twig is not null %}
                            html: '{% filter escape('js') %}{% include template.twig %}{% endfilter %}',
                            {% endif %}
                            title: '{{ template.title }}'
                        }
                        {% if loop.last == false %},{% endif %}
                        {% endfor %}
                    ]
                });
            {% endif %}
        {% endfor %}
        {% set plugins = '' %}
        {% for name, external_plugin in external_plugins %}
            CKEDITOR.plugins.addExternal('{{ name }}', '{{ app.request.basePath ~ external_plugin.path }}', '{{ external_plugin.file }}');
            {% if not loop.first %}
                {% set plugins = plugins ~ ',' %}
            {% endif %}
            {% set plugins = plugins ~ name %}
        {% endfor %}
        CKEDITOR.replace("{{ id }}",{
            {% if width is not null %}
                width: '{{ width }}',
            {% endif %}
            {% if height is not null %}
                height: '{{ height }}',
            {% endif %}
            {% if force_paste_as_plaintext is not null %}
                forcePasteAsPlainText: {{ force_paste_as_plaintext }},
            {% endif %}
            {% if language is not null %}
                language: '{{ language }}',
            {% endif %}
            {% if ui_color is not null %}
                uiColor: "{{ ui_color }}",
            {% endif %}
            {% if startup_outline_blocks == true %}
                startupOutlineBlocks: {{ startup_outline_blocks }},
            {% endif %}
            {% if filebrowser_browse_url.route is defined and filebrowser_browse_url.route is not null %}
                filebrowserBrowseUrl: '{{ path(filebrowser_browse_url.route, filebrowser_browse_url.route_parameters) }}',
            {% elseif filebrowser_browse_url.url is defined and filebrowser_browse_url.url is not null  %}
                filebrowserBrowseUrl: '{{ filebrowser_browse_url.url }}',
            {% endif %}
            {% if filebrowser_upload_url.route is defined and filebrowser_upload_url.route is not null %}
                filebrowserUploadUrl: '{{ path(filebrowser_upload_url.route, filebrowser_upload_url.route_parameters) }}',
            {% elseif filebrowser_upload_url.url is defined and filebrowser_upload_url.url is not null  %}
                filebrowserUploadUrl: '{{ filebrowser_upload_url.url }}',
            {% endif %}
            {% if filebrowser_image_browse_url.route is defined and filebrowser_image_browse_url.route is not null %}
                filebrowserImageBrowseUrl: '{{ path(filebrowser_image_browse_url.route, filebrowser_image_browse_url.route_parameters) }}',
            {% elseif filebrowser_image_browse_url.url is defined and filebrowser_image_browse_url.url is not null  %}
                filebrowserImageBrowseUrl: '{{ filebrowser_image_browse_url.url }}',
            {% endif %}

            {% if filebrowser_image_upload_url.route is defined and filebrowser_image_upload_url.route is not null %}
                filebrowserImageUploadUrl: '{{ path(filebrowser_image_upload_url.route, filebrowser_image_upload_url.route_parameters) }}',
            {% elseif filebrowser_image_upload_url.url is defined and filebrowser_image_upload_url.url is not null  %}
                filebrowserImageUploadUrl: '{{ filebrowser_image_upload_url.url }}',
            {% endif %}
            {% if filebrowser_flash_browse_url.route is defined and filebrowser_flash_browse_url.route is not null %}
                filebrowserFlashBrowseUrl: '{{ path(filebrowser_flash_browse_url.route, filebrowser_flash_browse_url.route_parameters) }}',
            {% elseif filebrowser_flash_browse_url.url is defined and filebrowser_flash_browse_url.url is not null  %}
                filebrowserFlashBrowseUrl: '{{ filebrowser_flash_browse_url.url }}',
            {% endif %}
            {% if filebrowser_flash_upload_url.route is defined and filebrowser_flash_upload_url.route is not null %}
                filebrowserFlashUploadUrl: '{{ path(filebrowser_flash_upload_url.route, filebrowser_flash_upload_url.route_parameters) }}',
            {% elseif filebrowser_flash_upload_url.url is defined and filebrowser_flash_upload_url.url is not null  %}
                filebrowserFlashUploadUrl: '{{ filebrowser_flash_upload_url.url }}',
            {% endif %}
            {% if skin is not null %}
                skin: '{{ skin }}',
            {% endif %}
            {% if format_tags|length > 0 %}
                format_tags: '{{ format_tags | join(';') | raw }}',
            {% endif %}
            {% if base_href is not null %}
                baseHref: '{{ base_href }}',
            {% endif %}
            {% if body_class is not null %}
                bodyClass: '{{ body_class }}',
            {% endif %}
            {% if contents_css is not null %}
                {% if contents_css is iterable %}
                    {% set contents_css_array = [] %}
                    {% for file in contents_css %}
                        {% set contents_css_array = contents_css_array|merge([asset(file)]) %}
                    {% endfor %}
                    contentsCss: {{ contents_css_array|json_encode }},
                {% else %}
                    contentsCss: '{{ asset(contents_css) }}',
                {% endif %}
            {% endif %}
            {% if basic_entities is not null %}
                basicEntities: '{{ basic_entities }}',
            {% endif %}
            {% if entities is not null %}
                entities: '{{ entities }}',
            {% endif %}
            {% if entities_latin is not null %}
                entities_latin: '{{ entities_latin }}',
            {% endif %}
            {% if startup_mode is not null %}
                startupMode: '{{ startup_mode }}',
            {% endif %}
            {% if plugins %}
                extraPlugins: '{{ plugins }}',
            {% endif %}
            {% if custom_config %}
                customConfig: '{{ asset(custom_config) }}',
            {% endif %}
            {% if fontsize_sizes is not null %}
                fontSize_sizes: '{{ fontsize_sizes }}',
            {% endif %}
            {% if extra_allowed_content is not null %}
                extraAllowedContent: '{{ extra_allowed_content }}',
            {% endif %}
            {% if styles_set is not null %}
                stylesSet: '{{ styles_set }}',
            {% endif %}
            {% if templates is not null %}
                templates: '{{ templates }}',
            {% endif %}
            {% if templates_files is not null %}
                {% if templates_files is iterable %}
                    {% set templates_files_array = [] %}
                    {% for file in templates_files %}
                        {% set templates_files_array = templates_files_array|merge([asset(file)]) %}
                    {% endfor %}
                    templates_files: {{ templates_files_array|json_encode }},
                {% else %}
                    templates_files: '{{ asset(templates_files) }}',
                {% endif %}
            {% endif %}
            {% if templates_replace_content is not null %}
                templates_replaceContent: '{{ templates_replace_content }}',
            {% endif %}
            toolbar: {{ toolbar | json_encode | raw }}
        });
    {% endautoescape %}
    </script>
{% endspaceless %}
{% endblock %}
